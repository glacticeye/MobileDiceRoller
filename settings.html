<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Mobile Dice Roller - Settings</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      color: white;
      background-color: #222;
      position: fixed;
    }

    #app-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      position: relative;
      z-index: 2;
    }

    #header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: rgba(0, 0, 0, 0.7);
      height: 60px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.5);
    }

    #header-title {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      flex: 1;
    }

    .back-btn {
      padding: 8px 15px;
      background: #3498db;
      border: none;
      border-radius: 5px;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .settings-content {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
    }

    .settings-section {
      margin-bottom: 25px;
    }

    .settings-section-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .colorset-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .colorset-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .colorset-item.active {
      background: rgba(52, 152, 219, 0.3);
      box-shadow: 0 0 0 2px #3498db;
    }

    .colorset-preview {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 20px;
      background-size: cover;
      position: relative;
      overflow: hidden;
    }

    .colorset-name {
      font-size: 14px;
      text-align: center;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .colorset-category {
      font-size: 11px;
      color: #aaa;
      margin-top: 3px;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .settings-footer {
      padding: 15px;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
    }

    .save-btn {
      width: 100%;
      max-width: 300px;
      padding: 12px;
      background: #2ecc71;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    /* For colorset preview backgrounds */
    .bg-gradient {
      background: linear-gradient(45deg, var(--color1), var(--color2));
    }

    .bg-solid {
      background-color: var(--color);
    }

    .texture-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0.5;
      background-size: cover;
    }

    /* Textures Assets*/    
    /* Basic textures */
    .texture-none { background-image: none; }
    .texture-marble { background-image: url('assets/textures/marble.webp'); }
    .texture-ice { background-image: url('assets/textures/ice.webp'); }
    .texture-fire { background-image: url('assets/textures/fire.webp'); }
    .texture-cloudy { background-image: url('assets/textures/cloudy.webp'); }
    .texture-speckles { background-image: url('assets/textures/speckles.webp'); }
    .texture-stars { background-image: url('assets/textures/stars.webp'); }
    .texture-skulls { background-image: url('assets/textures/skulls.webp'); }
    .texture-paper-bump { background-image: url('assets/textures/paper-bump.webp'); }
    .texture-metal { background-image: url('assets/textures/metal.webp'); }
    .texture-wood { background-image: url('assets/textures/wood.webp'); }
    .texture-water { background-image: url('assets/textures/water.webp'); }
    .texture-glitter { background-image: url('assets/textures/glitter.webp'); }

    /* Feather textures */
    .texture-feather { background-image: url('assets/textures/feather.webp'); }
    .texture-feather-bump { background-image: url('assets/textures/feather-bump.webp'); }

    /* Dragon textures */
    .texture-dragon { background-image: url('assets/textures/dragon.webp'); }
    .texture-dragon-bump { background-image: url('assets/textures/dragon-bump.webp'); }
    .texture-lizard { background-image: url('assets/textures/lizard.webp'); }
    .texture-lizard-bump { background-image: url('assets/textures/lizard-bump.webp'); }

    /* Animal print textures */
    .texture-leopard { background-image: url('assets/textures/leopard.webp'); }
    .texture-tiger { background-image: url('assets/textures/tiger.webp'); }
    .texture-cheetah { background-image: url('assets/textures/cheetah.webp'); }

    /* Bronze textures */
    .texture-bronze01 { background-image: url('assets/textures/bronze01.webp'); }
    .texture-bronze02 { background-image: url('assets/textures/bronze02.webp'); }
    .texture-bronze03 { background-image: url('assets/textures/bronze03.webp'); }
    .texture-bronze03a { background-image: url('assets/textures/bronze03a.webp'); }
    .texture-bronze03b { background-image: url('assets/textures/bronze03b.webp'); }
    .texture-bronze04 { background-image: url('assets/textures/bronze04.webp'); }

    /* Others */
    .texture-paper { background-image: url('assets/textures/paper.webp'); }
    .texture-glitter-alpha { background-image: url('assets/textures/glitter-alpha.webp'); }
    .texture-glitter-bump { background-image: url('assets/textures/glitter-bump.webp'); }
    .texture-stainedglass { background-image: url('assets/textures/stainedglass.webp'); }
    .texture-stainedglass-bump { background-image: url('assets/textures/stainedglass-bump.webp'); }

    /* Tab navigation for different settings */
    .tabs {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .tab {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }

    .tab.active {
      border-bottom-color: #3498db;
      font-weight: bold;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Filter controls */
    .filter-controls {
      display: flex;
      margin-bottom: 15px;
      overflow-x: auto;
      padding-bottom: 5px;
      -webkit-overflow-scrolling: touch;
    }

    .filter-btn {
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 15px;
      color: white;
      margin-right: 8px;
      white-space: nowrap;
      font-size: 12px;
    }

    .filter-btn.active {
      background: #3498db;
    }

    /* Custom Dice Factory Styles */
    .color-picker-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 20px;
    }

    .color-picker-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .color-picker-group label {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .color-picker-group input[type="color"] {
      width: 100%;
      height: 40px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .add-color-btn {
      background: #3498db;
      border: none;
      border-radius: 8px;
      color: white;
      padding: 8px;
      margin-top: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .color-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 5px;
    }

    .color-chip {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      position: relative;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.3);
    }

    .color-chip .remove-color {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #e74c3c;
      color: white;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .color-chip:hover .remove-color {
      opacity: 1;
    }

    .texture-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .texture-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 10px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: all 0.2s;
    }

    .texture-item.active {
      background: rgba(52, 152, 219, 0.2);
      box-shadow: 0 0 0 2px #3498db, 0 4px 8px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }

    .texture-preview {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      background-size: cover;
      background-position: center;
      position: relative;
      overflow: hidden;
    }

    .texture-name {
      font-size: 12px;
      text-align: center;
    }

    .custom-dice-preview {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }

    .preview-title {
      font-weight: bold;
      margin-bottom: 10px;
    }

    .preview-container {
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-dice {
      width: 100px;
      height: 100px;
      background-color: var(--bg-color, #ffffff);
      border: 2px solid var(--outline-color, #000000);
      border-radius: 10px;
      position: relative;
      transform: rotate(45deg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      color: var(--fg-color, #000000);
      overflow: hidden;
    }

    .preview-dice::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-size: cover;
      background-position: center;
      opacity: 0.5;
      background-image: var(--texture-image, none);
    }

    .preview-dice::after {
      content: "20";
      transform: rotate(-45deg);
    }
    
    /* Base colorset selection styles */
    .base-colorset-selection {
      margin-bottom: 20px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    
    .base-colorset-selection label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    
    .select-wrapper {
      display: flex;
      gap: 10px;
    }
    
    .select-wrapper select {
      flex: 1;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 5px;
      font-size: 14px;
      appearance: none;
      background-image: url("data:image/svg+xml;utf8,<svg fill='white' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
      background-repeat: no-repeat;
      background-position: right 8px center;
      padding-right: 30px;
    }
    
    /* Styling for dropdown options */
    .select-wrapper select option {
      background-color: #222;
      color: white;
    }
    
    .btn-primary {
      padding: 8px 12px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .btn-primary:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <div id="app-container">
    <!-- Header -->
    <div id="header">
      <button class="back-btn" id="back-button">←</button>
      <div id="header-title">Dice Settings</div>
      <div style="width: 40px;"></div> <!-- Spacer for balance -->
    </div>
    
    <!-- Tab Navigation -->
    <div class="tabs">
      <div class="tab active" data-tab="colorsets">Themes</div>
      <div class="tab" data-tab="customdice">Custom Dice</div>
      <div class="tab" data-tab="other">Options</div>
    </div>
    
    <!-- Settings Content -->
    <div class="settings-content">
      <!-- Colorsets Tab -->
      <div class="tab-content active" id="colorsets-tab">
        <div class="settings-section">
          <div class="settings-section-title">Color Themes</div>
          <div class="filter-controls">
            <button class="filter-btn active" data-category="Damage Types">Damage Types</button>
            <button class="filter-btn" data-category="Elements">Elements</button>
            <button class="filter-btn" data-category="Colors">Colors</button>
            <button class="filter-btn" data-category="Custom Sets">Custom Sets</button>
            <button class="filter-btn" data-category="Other">Other</button>
          </div>
          
          <div class="colorset-grid" id="colorset-grid">
            <!-- Colorset items will be generated here -->
          </div>
        </div>
        
        <div class="settings-section">
          <div class="settings-section-title">Dice Materials</div>
          <div class="colorset-grid">
            <div class="colorset-item" data-material="metal">
              <div class="colorset-preview">
                <div class="texture-overlay texture-metal"></div>
                M
              </div>
              <div class="colorset-name">Metal</div>
            </div>
            <div class="colorset-item" data-material="wood">
              <div class="colorset-preview">
                <div class="texture-overlay texture-wood"></div>
                W
              </div>
              <div class="colorset-name">Wood</div>
            </div>
            <div class="colorset-item" data-material="glass">
              <div class="colorset-preview">
                <div class="texture-overlay texture-stainedglass"></div>
                G
              </div>
              <div class="colorset-name">Glass</div>
            </div>
            <div class="colorset-item" data-material="plastic">
              <div class="colorset-preview">
                <div class="texture-overlay texture-speckles"></div>
                P
              </div>
              <div class="colorset-name">Plastic</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Custom Dice Tab -->
      <div class="tab-content" id="customdice-tab">
        <div class="settings-section">
          <div class="settings-section-title">Custom Dice Factory</div>
          
          <!-- Base Colorset Selection -->
          <div class="base-colorset-selection">
            <label for="base-colorset-select">Start from premade theme:</label>
            <div class="select-wrapper">
              <select id="base-colorset-select">
                <option value="">-- Choose a base theme --</option>
                <!-- Options will be populated via JavaScript -->
              </select>
              <button id="apply-base-colorset" class="btn-primary">Apply</button>
            </div>
          </div>
          
          <div class="color-picker-container">
            <div class="color-picker-group">
              <label>Foreground Color</label>
              <input type="color" id="foreground-color" value="#ffffff">
              <button class="add-color-btn" data-target="foreground">+ Add Color</button>
              <div class="color-chips" id="foreground-colors"></div>
            </div>
            
            <div class="color-picker-group">
              <label>Background Color</label>
              <input type="color" id="background-color" value="#000000">
              <button class="add-color-btn" data-target="background">+ Add Color</button>
              <div class="color-chips" id="background-colors"></div>
            </div>
            
            <div class="color-picker-group">
              <label>Outline Color</label>
              <input type="color" id="outline-color" value="#000000">
              <button class="add-color-btn" data-target="outline">+ Add Color</button>
              <div class="color-chips" id="outline-colors"></div>
            </div>
            
            <div class="color-picker-group">
              <label>Edge Color</label>
              <input type="color" id="edge-color" value="#000000">
              <button class="add-color-btn" data-target="edge">+ Add Color</button>
              <div class="color-chips" id="edge-colors"></div>
            </div>
          </div>
        </div>
        
        <div class="settings-section">
          <div class="settings-section-title">Texture Selection</div>
          <div class="texture-selector">
            <div class="texture-grid">
              <div class="texture-item" data-texture="none">
                <div class="texture-preview">None</div>
                <div class="texture-name">None</div>
              </div>
              <div class="texture-item" data-texture="marble">
                <div class="texture-preview texture-marble"></div>
                <div class="texture-name">Marble</div>
              </div>
              <div class="texture-item" data-texture="ice">
                <div class="texture-preview texture-ice"></div>
                <div class="texture-name">Ice</div>
              </div>
              <div class="texture-item" data-texture="fire">
                <div class="texture-preview texture-fire"></div>
                <div class="texture-name">Fire</div>
              </div>
              <div class="texture-item" data-texture="cloudy">
                <div class="texture-preview texture-cloudy"></div>
                <div class="texture-name">Cloudy</div>
              </div>
              <div class="texture-item" data-texture="speckles">
                <div class="texture-preview texture-speckles"></div>
                <div class="texture-name">Speckles</div>
              </div>
              <div class="texture-item" data-texture="metal">
                <div class="texture-preview texture-metal"></div>
                <div class="texture-name">Metal</div>
              </div>
              <div class="texture-item" data-texture="wood">
                <div class="texture-preview texture-wood"></div>
                <div class="texture-name">Wood</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="settings-section">
          <div class="settings-section-title">Material Selection</div>
          <div class="material-selector">
            <div class="colorset-grid">
              <div class="colorset-item" data-custom-material="metal">
                <div class="colorset-preview">
                  <div class="texture-overlay texture-metal"></div>
                  M
                </div>
                <div class="colorset-name">Metal</div>
              </div>
              <div class="colorset-item" data-custom-material="wood">
                <div class="colorset-preview">
                  <div class="texture-overlay texture-wood"></div>
                  W
                </div>
                <div class="colorset-name">Wood</div>
              </div>
              <div class="colorset-item" data-custom-material="glass">
                <div class="colorset-preview">
                  <div class="texture-overlay texture-stainedglass"></div>
                  G
                </div>
                <div class="colorset-name">Glass</div>
              </div>
              <div class="colorset-item" data-custom-material="plastic">
                <div class="colorset-preview">
                  <div class="texture-overlay texture-speckles"></div>
                  P
                </div>
                <div class="colorset-name">Plastic</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="settings-section">
          <div class="custom-dice-preview" id="custom-dice-preview">
            <div class="preview-title">Preview</div>
            <div class="preview-container">
              <div class="preview-dice"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Materials Tab - Content removed and moved to Themes tab -->
        
      <!-- Other Settings Tab -->
      <div class="tab-content" id="other-tab">
        <div class="settings-section">
          <div class="settings-section-title">Physics</div>
          <div style="display: flex; flex-direction: column; gap: 15px;">
            <div>
              <label style="display: block; margin-bottom: 5px;">Gravity: <span id="gravity-value">400</span></label>
              <input type="range" min="100" max="1000" value="400" step="50" class="slider" id="gravity-slider" style="width: 100%;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px;">Toss Strength: <span id="strength-value">1.5</span></label>
              <input type="range" min="0.5" max="3" value="1.5" step="0.1" class="slider" id="strength-slider" style="width: 100%;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px;">Scale: <span id="scale-value">1.0</span></label>
              <input type="range" min="0.5" max="2.0" value="1.0" step="0.1" class="slider" id="scale-slider" style="width: 100%;">
            </div>
          </div>
        </div>
        
        <div class="settings-section">
          <div class="settings-section-title">Audio & Graphics</div>
          <div style="display: flex; flex-direction: column; gap: 15px;">
            <div>
              <label style="display: block; margin-bottom: 5px;">Volume: <span id="volume-value">100</span>%</label>
              <input type="range" min="0" max="100" value="100" class="slider" id="volume-slider" style="width: 100%;">
            </div>
            <div style="display: flex; align-items: center; margin-top: 5px;">
              <input type="checkbox" id="shadows-checkbox" checked>
              <label for="shadows-checkbox" style="margin-left: 10px;">Enable Shadows</label>
            </div>
            <div style="display: flex; align-items: center; margin-top: 5px;">
              <input type="checkbox" id="sounds-checkbox" checked>
              <label for="sounds-checkbox" style="margin-left: 10px;">Enable Sounds</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer with save and reset buttons -->
    <div class="settings-footer">
      <div style="display: flex; width: 100%; max-width: 300px; gap: 10px;">
        <button class="reset-btn" id="reset-settings" style="flex: 1; padding: 12px; background: #e74c3c; border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: bold; cursor: pointer;">Reset</button>
        <button class="save-btn" id="save-settings" style="flex: 2;">Save Changes</button>
      </div>
    </div>
  </div>

  <script>
    // Colorsets data from https://github.com/3d-dice/dice-box-threejs/blob/main/src/const/colorsets.js
    const COLORSETS = {
      'black': {
        name: 'Black',
        category: 'Colors',
        foreground: '#ffffff',
        background: '#000000',
        outline: 'black',
        texture: 'none',
        description: 'Black',
      },
      'white': {
        name: 'White',
        category: 'Colors',
        foreground: '#000000',
        background: '#FFFFFF',
        outline: '#FFFFFF',
        texture: 'none',
        description: 'White'
      },
      'coin_default': {
        name: 'Gold Coin',
        description: 'Gold Dragonhead Coin',
        category: 'Colors',
        foreground: '#f6c928',
        background: '#f6c928',
        outline: 'none',
        texture: 'metal'
      },
      'radiant': {
        name: 'Radiant',
        category: 'Damage Types',
        foreground: '#F9B333',
        background: '#FFFFFF',
        outline: '',
        texture: 'paper-bump',
        description: 'Radiant'
      },
      'fire': {
        name: 'Fire',
        category: 'Damage Types',
        foreground: '#f8d84f',
        background: ['#f8d84f','#f9b02d','#f43c04','#910200','#4c1009'],
        outline: 'black',
        texture: 'fire',
        description: 'Fire'
      },
      'ice': {
        name: 'Ice',
        category: 'Damage Types',
        foreground: '#60E9FF',
        background: ['#214fa3','#3c6ac1','#253f70','#0b56e2','#09317a'],
        outline: 'black',
        texture: 'ice',
        description: 'Ice'
      },
      'lightning': {
        name: 'Lightning',
        category: 'Damage Types',
        foreground: '#FFC500',
        background: ['#f17105', '#f3ca40','#eddea4','#df9a57','#dea54b'],
        outline: '#7D7D7D',
        texture: 'ice',
        description: 'Lightning'
      },
      'thunder': {
        name: 'Thunder',
        category: 'Damage Types',
        foreground: '#FFC500',
        background: '#7D7D7D',
        outline: 'black',
        texture: 'cloudy',
        description: 'Thunder'
      },
      'poison': {
        name: 'Poison',
        category: 'Damage Types',
        foreground: '#D6A8FF',
        background: ['#313866','#504099','#66409e','#934fc3','#c949fc'],
        outline: 'black',
        texture: 'cloudy',
        description: 'Poison'
      },
      'acid': {
        name: 'Acid',
        category: 'Damage Types',
        foreground: '#A9FF70',
        background: ['#a6ff00', '#83b625','#5ace04','#69f006','#b0f006','#93bc25'],
        outline: 'black',
        texture: 'marble',
        description: 'Acid'
      },
      'psychic': {
        name: 'Psychic',
        category: 'Damage Types',
        foreground: '#D6A8FF',
        background: ['#313866','#504099','#66409E','#934FC3','#C949FC','#313866'],
        outline: 'black',
        texture: 'speckles',
        description: 'Psychic'
      },
      'necrotic': {
        name: 'Necrotic',
        category: 'Damage Types',
        foreground: '#ffffff',
        background: '#6F0000',
        outline: 'black',
        texture: 'skulls',
        description: 'Necrotic'
      },
      'air': {
        name: 'Air',
        category: 'Elements',
        foreground: '#ffffff',
        background: ['#d0e5ea', '#c3dee5','#a4ccd6','#8dafb7','#80a4ad'],
        outline: 'black',
        texture: 'cloudy',
        description: 'Air'
      },
      'water': {
        name: 'Water',
        category: 'Elements',
        foreground: '#60E9FF',
        background: ['#87b8c4', '#77a6b2','#6b98a3','#5b8691','#4b757f'],
        outline: 'black',
        texture: 'water',
        description: 'Water'
      },
      'earth': {
        name: 'Earth',
        category: 'Elements',
        foreground: '#6C9943',
        background: ['#346804', '#184200','#527f22', '#3a1d04', '#56341a','#331c17','#5a352a','#302210'],
        outline: 'black',
        texture: 'speckles',
        description: 'Earth'
      },
      'force': {
        name: 'Force',
        category: 'Elements',
        foreground: 'white',
        background: ['#FF97FF', '#FF68FF','#C651C6'],
        outline: '#570000',
        texture: 'stars',
        description: 'Force'
      },
      'breebaby': {
        name: 'Pastel Sunset',
        category: 'Custom Sets',
        foreground: ['#5E175E', '#564A5E','#45455E','#3D5A5E','#1E595E','#5E3F3D','#5E1E29','#283C5E','#25295E'],
        background: ['#FE89CF', '#DFD4F2','#C2C2E8','#CCE7FA','#A1D9FC','#F3C3C2','#EB8993','#8EA1D2','#7477AD'],
        outline: 'white',
        texture: 'marble',
        description: 'Pastel Sunset, for Breyanna'
      },
      'pinkdreams': {
        name: 'Pink Dreams',
        category: 'Custom Sets',
        foreground: 'white',
        background: ['#ff007c', '#df73ff','#f400a1','#df00ff','#ff33cc'],
        outline: '#570000',
        texture: 'skulls',
        description: 'Pink Dreams, for Ethan'
      },
      'inspired': {
        name: 'Inspired',
        category: 'Custom Sets',
        foreground: '#FFD800',
        background: '#C4C4B6',
        outline: '#8E8E86',
        texture: 'none',
        description: 'Inspired, for Austin'
      },
      'bloodmoon': {
        name: 'Blood Moon',
        category: 'Custom Sets',
        foreground: '#CDB800',
        background: '#6F0000',
        outline: 'black',
        texture: 'marble',
        description: 'Blood Moon, for Jared'
      },
      'starynight': {
        name: 'Stary Night',
        category: 'Custom Sets',
        foreground: '#4F708F',
        background: ['#091636','#233660','#4F708F','#8597AD','#E2E2E2'],
        outline: 'white',
        texture: 'speckles',
        description: 'Stary Night, for Mai'
      },
      'glitterparty': {
        name: 'Glitter Party',
        category: 'Custom Sets',
        foreground: 'white',
        background: ['#FFB5F5','#7FC9FF','#A17FFF'],
        outline: 'none',
        texture: 'glitter',
        description: 'Glitter Party, for Austin'
      },
      'astralsea': {
        name: 'Astral Sea',
        category: 'Custom Sets',
        foreground: '#565656',
        background: 'white',
        outline: 'none',
        texture: 'stars',
        description: 'The Astral Sea, for Austin'
      },
      'bronze': {
        name: 'Thylean Bronze',
        category: 'Custom Sets',
        foreground: ['#FF9159','#FFB066','#FFBF59','#FFD059'],
        background: ['#705206','#7A4E06','#643100','#7A2D06'],
        outline: ['#3D2D03','#472D04','#301700','#471A04'],
        edge: ['#FF5D0D','#FF7B00','#FFA20D','#FFBA0D'],
        texture: ['bronze01','bronze02','bronze03','bronze03a','bronze03b','bronze04'],
        description: 'Thylean Bronze by @SpencerThayer'
      },
      'dragons': {
        name: 'Here be Dragons',
        category: 'Custom Sets',
        foreground: '#FFFFFF',
        background: ['#B80000', '#4D5A5A', '#5BB8FF', '#7E934E', '#FFFFFF', '#F6ED7C', '#7797A3', '#A78437', '#862C1A', '#FFDF8A'],
        outline: 'black',
        texture: ['dragon', 'lizard'],
        description: 'Here be Dragons'
      },
      'birdup': {
        name: 'Bird Up',
        category: 'Custom Sets',
        foreground: '#FFFFFF',
        background: ['#F11602', '#FFC000', '#6EC832', '#0094BC', '#05608D', '#FEABB3', '#F75680', '#F3F0DF', '#C7A57F'],
        outline: 'black',
        texture: 'feather',
        description: 'Bird Up!'
      },
      'tigerking': {
        name: 'Tiger King',
        category: 'Custom Sets',
        foreground: '#ffffff',
        background: '#FFCC40',
        outline: 'black',
        texture: ['leopard', 'tiger', 'cheetah'],
        description: 'Leopard Print'
      },
    };

    document.addEventListener('DOMContentLoaded', () => {
      // Default settings
      const DEFAULT_SETTINGS = {
        colorset: 'white', // Set white as the default colorset
        texture: null, // 'none' is an actual texture name, null means no texture
        material: 'plastic',
        gravity: 200,
        strength: 1.5,
        baseScale: 1.0,
        volume: 100,
        shadows: true,
        sounds: true,
        customColorset: {
          foreground: "#000000",
          background: "#FFFFFF",
          outline: "#FFFFFF",
          edge: "#FFFFFF",
          texture: "wood",
          material: 'wood'
        }
      };
      
      // Current settings (initialized with default values)
      let currentSettings = {...DEFAULT_SETTINGS};
      
      // Custom colorset settings
      let customDiceSettings = {
          foreground: "#000000",
          background: "#FFFFFF",
          outline: "#FFFFFF",
          edge: "#FFFFFF",
          texture: "wood",
          material: 'wood'
      };
      
      // Try to load saved settings from localStorage
      try {
        const savedSettings = localStorage.getItem('diceSettings');
        if (savedSettings) {
          currentSettings = {...currentSettings, ...JSON.parse(savedSettings)};
          
          // Load custom colorset if it exists
          if (currentSettings.customColorset) {
            customDiceSettings = {...customDiceSettings, ...currentSettings.customColorset};
          }
          
          // Update UI based on loaded settings
          updateUIFromSettings(currentSettings);
        }
      } catch (e) {
        console.error('Error loading saved settings:', e);
      }
      
      // Function to update UI elements based on settings
      function updateUIFromSettings(settings) {
        // Update sliders and display values
        document.getElementById('gravity-slider').value = settings.gravity;
        document.getElementById('gravity-value').textContent = settings.gravity;
        
        document.getElementById('strength-slider').value = settings.strength;
        document.getElementById('strength-value').textContent = settings.strength;
        
        document.getElementById('scale-slider').value = settings.baseScale;
        document.getElementById('scale-value').textContent = settings.baseScale;
        
        document.getElementById('volume-slider').value = settings.volume;
        document.getElementById('volume-value').textContent = settings.volume;
        
        // Update checkboxes
        document.getElementById('shadows-checkbox').checked = settings.shadows;
        document.getElementById('sounds-checkbox').checked = settings.sounds;
        
        // Update active selections
        if (settings.colorset) {
          const colorsetItem = document.querySelector(`[data-colorset="${settings.colorset}"]`);
          if (colorsetItem) colorsetItem.classList.add('active');
        }
        
        if (settings.material) {
          const materialItem = document.querySelector(`[data-material="${settings.material}"]`);
          if (materialItem) materialItem.classList.add('active');
        }
        
        // Update custom dice UI if custom colorset exists
        if (settings.customColorset) {
          const customColors = settings.customColorset;
          
          // Update color chips for each color type
          updateColorChips('foreground', customColors.foreground || []);
          updateColorChips('background', customColors.background || []);
          updateColorChips('outline', customColors.outline || []);
          updateColorChips('edge', customColors.edge || []);
          
          // Update texture selection
          if (customColors.texture) {
            const textureItem = document.querySelector(`[data-texture="${customColors.texture}"]`);
            if (textureItem) textureItem.classList.add('active');
          }
          
          // Update material selection
          if (customColors.material) {
            const materialItem = document.querySelector(`[data-custom-material="${customColors.material}"]`);
            if (materialItem) materialItem.classList.add('active');
          }
          
          // Update preview
          updateCustomDicePreview();
        }
      }
      
      // Generate colorset items
      const colorsetGrid = document.getElementById('colorset-grid');
      
      function generateColorsetItems(filter = 'all') {
        colorsetGrid.innerHTML = '';
        
        Object.entries(COLORSETS).forEach(([key, colorset]) => {
          if (filter !== 'all' && colorset.category !== filter) return;
          
          const item = document.createElement('div');
          item.className = 'colorset-item';
          item.dataset.colorset = key;
          
          if (key === currentSettings.colorset) {
            item.classList.add('active');
          }
          
          const preview = document.createElement('div');
          preview.className = 'colorset-preview';
          
          // Handle colorset preview background
          if (Array.isArray(colorset.background)) {
            // Get the first two colors for the gradient
            preview.style.setProperty('--color1', colorset.background[0]);
            preview.style.setProperty('--color2', colorset.background[1] || colorset.background[0]);
            preview.classList.add('bg-gradient');
          } else {
            preview.style.setProperty('--color', colorset.background);
            preview.classList.add('bg-solid');
          }
          
          // Add text in the foreground color
          preview.style.color = Array.isArray(colorset.foreground) 
            ? colorset.foreground[0] 
            : colorset.foreground;
          preview.textContent = 'D20';
          
          // Add texture overlay if applicable
          if (colorset.texture && colorset.texture !== 'none') {
            let textureClass;
            if (Array.isArray(colorset.texture)) {
              // Use the first texture from the array
              textureClass = `texture-${colorset.texture[0]}`;
            } else {
              textureClass = `texture-${colorset.texture}`;
            }
              
            const textureOverlay = document.createElement('div');
            textureOverlay.className = `texture-overlay ${textureClass}`;
            preview.appendChild(textureOverlay);
            
            // Store the texture in the dataset for selection
            item.dataset.texture = Array.isArray(colorset.texture) ? colorset.texture[0] : colorset.texture;
          }
          
          const name = document.createElement('div');
          name.className = 'colorset-name';
          name.textContent = colorset.name;
          
          const category = document.createElement('div');
          category.className = 'colorset-category';
          category.textContent = colorset.category;
          
          item.appendChild(preview);
          item.appendChild(name);
          item.appendChild(category);
          
          // Add click event listener to select colorset
          item.addEventListener('click', () => {
            // Remove active class from all colorset items
            document.querySelectorAll('#colorset-grid .colorset-item').forEach(el => {
              el.classList.remove('active');
            });
            
            // Add active class to clicked item
            item.classList.add('active');
            
            // Update current settings
            currentSettings.colorset = key;

            // Update texture if this colorset has a texture, otherwise clear it
            if (item.dataset.texture) {
              currentSettings.texture = item.dataset.texture;
            } else {
              // Reset texture when selecting a colorset without texture
              currentSettings.texture = null;
            }
          });
          
          colorsetGrid.appendChild(item);
        });
      }
      
      // Generate initial colorset items with Damage Types filter
      generateColorsetItems('Damage Types');
      
      // Set up category filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          // Remove active class from all filter buttons
          document.querySelectorAll('.filter-btn').forEach(el => {
            el.classList.remove('active');
          });
          
          // Add active class to clicked button
          btn.classList.add('active');
          
          // Generate filtered colorset items
          generateColorsetItems(btn.dataset.category);
        });
      });
      
      // Set up material selection
      document.querySelectorAll('[data-material]').forEach(item => {
        if (item.dataset.material === currentSettings.material) {
          item.classList.add('active');
        }
        
        item.addEventListener('click', () => {
          document.querySelectorAll('[data-material]').forEach(el => {
            el.classList.remove('active');
          });
          
          item.classList.add('active');
          currentSettings.material = item.dataset.material;
        });
      });
      
      // Set up slider event listeners
      document.getElementById('gravity-slider').addEventListener('input', (e) => {
        const value = parseInt(e.target.value);
        currentSettings.gravity = value;
        document.getElementById('gravity-value').textContent = value;
      });
      
      document.getElementById('strength-slider').addEventListener('input', (e) => {
        const value = parseFloat(e.target.value);
        currentSettings.strength = value;
        document.getElementById('strength-value').textContent = value;
      });
      
      document.getElementById('scale-slider').addEventListener('input', (e) => {
        const value = parseFloat(e.target.value);
        currentSettings.baseScale = value;
        document.getElementById('scale-value').textContent = value;
      });
      
      document.getElementById('volume-slider').addEventListener('input', (e) => {
        const value = parseInt(e.target.value);
        currentSettings.volume = value;
        document.getElementById('volume-value').textContent = value;
      });
      
      // Set up checkbox event listeners
      document.getElementById('shadows-checkbox').addEventListener('change', (e) => {
        currentSettings.shadows = e.target.checked;
      });
      
      document.getElementById('sounds-checkbox').addEventListener('change', (e) => {
        currentSettings.sounds = e.target.checked;
      });
      
      // Reset settings function
      function resetSettings() {
        // Reset current settings to defaults
        currentSettings = {...DEFAULT_SETTINGS};
        
        // Reset custom dice settings
        customDiceSettings = {
          foreground: "#000000",
          background: "#FFFFFF",
          outline: "#FFFFFF",
          edge: "#FFFFFF",
          texture: "wood",
          material: 'wood'
        };
        
        // Clear all color chips
        updateColorChips('foreground', []);
        updateColorChips('background', []);
        updateColorChips('outline', []);
        updateColorChips('edge', []);

        // Update UI with default settings
        updateUIFromSettings(currentSettings);
        
        // Reset all active selections
        document.querySelectorAll('.colorset-item.active').forEach(item => {
          item.classList.remove('active');
        });
        
        // Select default colorset
        const defaultColorsetItem = document.querySelector(`[data-colorset="${DEFAULT_SETTINGS.colorset}"]`);
        if (defaultColorsetItem) defaultColorsetItem.classList.add('active');
        
        // Select default material
        const defaultMaterialItem = document.querySelector(`[data-material="${DEFAULT_SETTINGS.material}"]`);
        if (defaultMaterialItem) defaultMaterialItem.classList.add('active');
        
        // Reset all active texture selections
        document.querySelectorAll('.texture-item.active').forEach(item => {
          item.classList.remove('active');
        });
        
        // Reset sliders
        document.getElementById('gravity-slider').value = DEFAULT_SETTINGS.gravity;
        document.getElementById('gravity-value').textContent = DEFAULT_SETTINGS.gravity;
        
        document.getElementById('strength-slider').value = DEFAULT_SETTINGS.strength;
        document.getElementById('strength-value').textContent = DEFAULT_SETTINGS.strength;
        
        document.getElementById('scale-slider').value = DEFAULT_SETTINGS.baseScale;
        document.getElementById('scale-value').textContent = DEFAULT_SETTINGS.baseScale;
        
        document.getElementById('volume-slider').value = DEFAULT_SETTINGS.volume;
        document.getElementById('volume-value').textContent = DEFAULT_SETTINGS.volume;
        
        // Reset checkboxes
        document.getElementById('shadows-checkbox').checked = DEFAULT_SETTINGS.shadows;
        document.getElementById('sounds-checkbox').checked = DEFAULT_SETTINGS.sounds;
        
        // Reset the custom dice preview
        updateCustomDicePreview();
      }
      
      // Reset settings button
      document.getElementById('reset-settings').addEventListener('click', () => {
        if (confirm('Are you sure you want to reset all settings to default?')) {
          resetSettings();
        }
      });
      
      // Save settings
      document.getElementById('save-settings').addEventListener('click', () => {
        try {
          // Validate and prepare custom dice settings
          const hasCustomDice = Object.values(customDiceSettings).some(value => {
            if (Array.isArray(value)) {
              return value.length > 0;
            }
            return value !== null;
          });
          
          // Only add custom colorset if it has settings
          if (hasCustomDice) {
            currentSettings.customColorset = {...customDiceSettings};
          } else {
            currentSettings.customColorset = null;
          }
          
          // Save all settings
          localStorage.setItem('diceSettings', JSON.stringify(currentSettings));
          
          // Provide feedback
          const saveBtn = document.getElementById('save-settings');
          const originalText = saveBtn.textContent;
          saveBtn.textContent = 'Saved!';
          saveBtn.style.backgroundColor = '#27ae60';
          
          setTimeout(() => {
            saveBtn.textContent = originalText;
            saveBtn.style.backgroundColor = '';
            
            // Go back to main screen
            window.location.href = 'index.html';
          }, 1000);
          
        } catch (e) {
          console.error('Error saving settings:', e);
          alert('Error saving settings. Please try again.');
        }
      });
      
      // Back button
      document.getElementById('back-button').addEventListener('click', () => {
        // Ask for confirmation if settings have changed
        const savedSettings = localStorage.getItem('diceSettings');
        let hasChanges = false;
        
        if (savedSettings) {
          const oldSettings = JSON.parse(savedSettings);
          // Check if any setting has changed
          for (const key in currentSettings) {
            if (currentSettings[key] !== oldSettings[key]) {
              hasChanges = true;
              break;
            }
          }
        } else {
          // If no saved settings, any non-null value means changes
          hasChanges = Object.values(currentSettings).some(value => value !== null);
        }
        
        if (hasChanges) {
          if (confirm('You have unsaved changes. Are you sure you want to go back without saving?')) {
            window.location.href = 'index.html';
          }
        } else {
          window.location.href = 'index.html';
        }
      });
      
      // Custom Dice Factory functions
      
      // Function to add a color chip
      function addColorChip(type, color) {
        // Don't add duplicate colors
        if (customDiceSettings[type].includes(color)) {
          return;
        }
        
        // Add to our data model
        customDiceSettings[type].push(color);
        
        // Update the UI
        updateColorChips(type, customDiceSettings[type]);
        
        // Update preview
        updateCustomDicePreview();
      }
      
      // Function to remove a color chip
      function removeColorChip(type, index) {
        if (index >= 0 && index < customDiceSettings[type].length) {
          // Remove from our data model
          customDiceSettings[type].splice(index, 1);
          
          // Update the UI
          updateColorChips(type, customDiceSettings[type]);
          
          // Update preview
          updateCustomDicePreview();
        }
      }
      
      // Function to update color chips display
      function updateColorChips(type, colors) {
        const container = document.getElementById(`${type}-colors`);
        if (!container) return;
        
        // Clear container
        container.innerHTML = '';
        
        // Add a chip for each color
        colors.forEach((color, index) => {
          const chip = document.createElement('div');
          chip.className = 'color-chip';
          chip.style.backgroundColor = color;
          
          // Add remove button
          const removeBtn = document.createElement('div');
          removeBtn.className = 'remove-color';
          removeBtn.textContent = '×';
          removeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            removeColorChip(type, index);
          });
          
          chip.appendChild(removeBtn);
          container.appendChild(chip);
        });
      }
      
      // Function to update the custom dice preview
      function updateCustomDicePreview() {
        const previewDice = document.querySelector('.preview-dice');
        if (!previewDice) return;
        
        // Set background color - use first color if array, or direct value
        const bgColor = customDiceSettings.background.length > 0 ? 
                        customDiceSettings.background[0] : '#ffffff';
        previewDice.style.setProperty('--bg-color', bgColor);
        
        // Set foreground color - use first color if array, or direct value
        const fgColor = customDiceSettings.foreground.length > 0 ? 
                        customDiceSettings.foreground[0] : '#000000';
        previewDice.style.setProperty('--fg-color', fgColor);
        
        // Set outline color
        const outlineColor = customDiceSettings.outline.length > 0 ? 
                            customDiceSettings.outline[0] : 'transparent';
        previewDice.style.borderColor = outlineColor;
        
        // Set texture
        if (customDiceSettings.texture && customDiceSettings.texture !== 'none') {
          previewDice.style.setProperty('--texture-image', `url('assets/textures/${customDiceSettings.texture}.webp')`);
        } else {
          previewDice.style.setProperty('--texture-image', 'none');
        }
      }
      
      // Set up color picker event listeners
      document.querySelectorAll('.add-color-btn').forEach(btn => {
        const type = btn.dataset.target;
        const colorPicker = document.getElementById(`${type}-color`);
        
        btn.addEventListener('click', () => {
          if (colorPicker) {
            addColorChip(type, colorPicker.value);
          }
        });
      });
      
      // Set up texture selection
      document.querySelectorAll('.texture-item').forEach(item => {
        item.addEventListener('click', () => {
          // Remove active class from all texture items
          document.querySelectorAll('.texture-item').forEach(el => {
            el.classList.remove('active');
          });
          
          // Add active class to clicked item
          item.classList.add('active');
          
          // Update data model
          customDiceSettings.texture = item.dataset.texture;
          
          // Update preview
          updateCustomDicePreview();
        });
      });
      
      // Set up custom material selection
      document.querySelectorAll('[data-custom-material]').forEach(item => {
        item.addEventListener('click', () => {
          // Remove active class from all material items
          document.querySelectorAll('[data-custom-material]').forEach(el => {
            el.classList.remove('active');
          });
          
          // Add active class to clicked item
          item.classList.add('active');
          
          // Update data model
          customDiceSettings.material = item.dataset.customMaterial;
          
          // Update preview
          updateCustomDicePreview();
        });
      });
      
      // Populate the base colorset dropdown
      function populateBaseColorsetDropdown() {
        const dropdown = document.getElementById('base-colorset-select');
        if (!dropdown) return;
        
        // Clear existing options (except the first one)
        while (dropdown.options.length > 1) {
          dropdown.remove(1);
        }
        
        // Add options from COLORSETS object
        Object.entries(COLORSETS).forEach(([key, colorset]) => {
          const option = document.createElement('option');
          option.value = key;
          option.textContent = `${colorset.name} (${colorset.category})`;
          dropdown.appendChild(option);
        });
      }
      
      // Initialize the base colorset dropdown
      populateBaseColorsetDropdown();
      
      // Set up the apply base colorset button
      document.getElementById('apply-base-colorset')?.addEventListener('click', () => {
        const select = document.getElementById('base-colorset-select');
        const selectedKey = select.value;
        
        if (selectedKey && COLORSETS[selectedKey]) {
          const colorset = COLORSETS[selectedKey];
          
          // Clear existing custom colors
          customDiceSettings.foreground = [];
          customDiceSettings.background = [];
          customDiceSettings.outline = [];
          customDiceSettings.edge = [];
          
          // Apply foreground colors
          if (colorset.foreground) {
            if (Array.isArray(colorset.foreground)) {
              colorset.foreground.forEach(color => {
                customDiceSettings.foreground.push(color);
              });
            } else {
              customDiceSettings.foreground.push(colorset.foreground);
            }
            updateColorChips('foreground', customDiceSettings.foreground);
          }
          
          // Apply background colors
          if (colorset.background) {
            if (Array.isArray(colorset.background)) {
              colorset.background.forEach(color => {
                customDiceSettings.background.push(color);
              });
            } else {
              customDiceSettings.background.push(colorset.background);
            }
            updateColorChips('background', customDiceSettings.background);
          }
          
          // Apply outline colors
          if (colorset.outline) {
            if (Array.isArray(colorset.outline)) {
              colorset.outline.forEach(color => {
                customDiceSettings.outline.push(color);
              });
            } else {
              customDiceSettings.outline.push(colorset.outline);
            }
            updateColorChips('outline', customDiceSettings.outline);
          }
          
          // Apply edge colors
          if (colorset.edge) {
            if (Array.isArray(colorset.edge)) {
              colorset.edge.forEach(color => {
                customDiceSettings.edge.push(color);
              });
            } else if (colorset.edge !== 'none') {
              customDiceSettings.edge.push(colorset.edge);
            }
            updateColorChips('edge', customDiceSettings.edge);
          }
          
          // Apply texture
          if (colorset.texture && colorset.texture !== 'none') {
            let texture;
            if (Array.isArray(colorset.texture)) {
              texture = colorset.texture[0];
            } else {
              texture = colorset.texture;
            }
            
            customDiceSettings.texture = texture;
            
            // Update texture selection UI
            document.querySelectorAll('.texture-item').forEach(item => {
              item.classList.remove('active');
              if (item.dataset.texture === texture) {
                item.classList.add('active');
              }
            });
          }
          
          // Update preview
          updateCustomDicePreview();
          
          // Reset the dropdown
          select.selectedIndex = 0;
        }
      });
      
      // Set up tab navigation
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs and content
          document.querySelectorAll('.tab, .tab-content').forEach(el => {
            el.classList.remove('active');
          });
          
          // Add active class to clicked tab and corresponding content
          tab.classList.add('active');
          document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
        });
      });
      
      // Handle image loading errors
      document.querySelectorAll('.texture-overlay').forEach(overlay => {
        overlay.addEventListener('error', function() {
          this.style.display = 'none';
          console.warn(`Failed to load texture: ${this.className}`);
        });
      });
      
      // Function to apply dice settings to the box
      function applyDiceSettings(settings) {
        if (!Box) {
          console.error('Dice box not initialized');
          return;
        }
        
        const config = {};
        
        // Apply gravity
        if (settings.gravity) {
          config.gravity_multiplier = settings.gravity;
        }
        
        // Apply toss strength
        if (settings.strength) {
          config.strength = settings.strength;
        }
        
        // Apply volume
        if (settings.volume !== undefined) {
          config.volume = settings.volume;
        }
        
        // Apply shadows
        if (settings.shadows !== undefined) {
          config.shadows = settings.shadows;
        }
        
        // Apply sounds
        if (settings.sounds !== undefined) {
          config.sounds = settings.sounds;
        }

        // Apply scale
        if (settings.baseScale !== undefined) {
          config.baseScale = settings.baseScale;
        }
        
        // Update the dice box with new settings
        Box.updateConfig(config);
      }
    });
  </script>
</body>
</html>